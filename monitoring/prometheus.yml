global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: "opareta-monitor"
    cluster: "opareta"

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets: []

# Load alert rules
rule_files:
  - "/etc/prometheus/alerts/*.yml"

scrape_configs:
  # Prometheus self-monitoring
  - job_name: "prometheus"
    static_configs:
      - targets: ["localhost:9090"]
        labels:
          service: "prometheus"

  # Auth service metrics
  - job_name: "auth-service"
    metrics_path: "/metrics"
    static_configs:
      - targets: ["auth:3001"]
        labels:
          service: "auth"
          environment: "development"
    scrape_interval: 15s
    scrape_timeout: 10s

  # Payments service metrics
  - job_name: "payments-service"
    metrics_path: "/metrics"
    static_configs:
      - targets: ["payments:3002"]
        labels:
          service: "payments"
          environment: "development"
    scrape_interval: 15s
    scrape_timeout: 10s

  # Node Exporter - System metrics
  - job_name: "node-exporter"
    static_configs:
      - targets: ["node-exporter:9100"]
        labels:
          service: "node-exporter"
          instance: "host"

  # PostgreSQL Exporter - Auth Database metrics
  - job_name: "postgres-exporter-auth"
    static_configs:
      - targets: ["postgres-exporter-auth:9187"]
        labels:
          service: "postgres-exporter"
          database: "auth_db"

  # PostgreSQL Exporter - Payments Database metrics
  - job_name: "postgres-exporter-payments"
    static_configs:
      - targets: ["postgres-exporter-payments:9187"]
        labels:
          service: "postgres-exporter"
          database: "payments_db"

  # Redis Exporter - Cache metrics
  - job_name: "redis-exporter"
    static_configs:
      - targets: ["redis-exporter:9121"]
        labels:
          service: "redis-exporter"

  # Nginx Exporter - Reverse proxy metrics (stub_status)
  - job_name: "nginx-exporter"
    static_configs:
      - targets: ["nginx-exporter:9113"]
        labels:
          service: "nginx-exporter"

  # Nginx Log Exporter - Access log metrics (status codes, latency)
  - job_name: "nginx-log-exporter"
    static_configs:
      - targets: ["nginx-log-exporter:9114"]
        labels:
          service: "nginx-log-exporter"
